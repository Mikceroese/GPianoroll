<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPianoroll</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0; /* Light background for contrast */
            position: relative;
        }

        /* Main container */
        .main-container {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 128, 128, 0.6); /* Teal with transparency */
            border-radius: 15px;
            padding: 40px;
            width: 90vw; /* Cover 90% of the viewport width */
            height: 90vh; /* Cover 90% of the viewport height */
            /*max-width: 1200px; /* Optional: Limit max width */
            /*max-height: 800px; /* Optional: Limit max height */
        }

        .container {
            display: flex;
            flex: 3;
            justify-content: center;
            flex-direction: column;
            align-items: center;
        }

        /* Logo area */
        .logo {
            width: 100%;
            text-align: center;
            margin-bottom: 40px;
        }

        /* Placeholder logo image */
        .logo img {
            max-width: 40vw; /* Adjusted size for larger screens */
            height: auto;
        }

        /* Form area */
        .form-area {
            display: flex;
            flex-direction: column;
            align-items: center; /* Centers the form elements */
            width: 100%;
        }

        form {
            display: flex;
            flex-direction: column;
            align-items: center; /* Centers the form elements */
            width: 60%;
        }

        /* Input styling */
        input[type="text"] {
            width: 60%; /* Reduced width to fit within larger container */
            padding: 10px;
            font-size: 1.2em;
            margin-bottom: 20px;
            border: none;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            text-align: center; /* Centers the text inside the input */
        }

        /* Submit button styling */
        button {
            padding: 10px 20px;
            font-size: 1.2em;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        button:hover {
            background-color: #45a049;
        }

        .bubble-button {
            padding: 5px 10px;
            margin: 5px;
            font-size: 1.1em;
        }

        /* Mascot container */
        .mascot-container {
            flex: 2;
            top: 5%; /* Add some margin from the top */
            left: 5%; /* Add some margin from the left */
            display: flex;
            align-items: center;
            height: 90vh; /* Full height of the screen */
            justify-content: center; /* Center vertically within its area */
            margin-top: 0; /* Ensure no extra margin interferes with centering */
            z-index: 9; /* Ensures the bubble is on top of the container */
        }


        /* Mascot image */
        .mascot {
            height: 90vh; /* Full height of the screen */
            width: auto;
            margin-bottom: 10px;
        }

        /* Speech bubble styling */
        .speech-bubble {
            position: relative;
            top: -20%;
            transform: translateY(-50%); /* Center vertically */
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 10px;
            max-width: 20vw;
            text-align: center;
            font-size: 1em;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 10; /* Ensures the bubble is on top of the container */
            margin-left: 20px; /* Increased margin for more space */
        }

        /* Arrow for the speech bubble */
        .speech-bubble::after {
            content: '';
            position: absolute;
            top: 50%;
            left: -15px; /* Move arrow to the left of the speech bubble */
            margin-top: -10px; /* Adjust positioning */
            border-width: 10px;
            border-style: solid;
            border-color: transparent rgba(255, 255, 255, 0.9) transparent transparent; /* Change to match the bubble */
        }

        /* Overlay styling */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(128, 128, 128, 0.5); /* Gray overlay */
            z-index: 5; /* Behind the speech bubble */
            display: none; /* Initially hidden */
        }

    </style>
</head>
<body>

    <div class="main-container">

        <!-- Mascot and Speech Bubble -->
        <div class="mascot-container">
            <div class="container">
                <img src="/static/Bastien.png" alt="Mascot" class="mascot">
                <button id="tour-button">Show me around</button>
            </div>
            <div class="speech-bubble" id="speech-bubble">
                <p>Welcome to GPianoroll! Enter your username to start.</p>
                <p>First time? Click the button below.</p>
            </div>
        </div>

        <div class="container">
            <!-- Logo Area -->
            <div class="logo">
                <img src="/static/Logo_GPianoroll.png" alt="Logo">
            </div>

            <!-- Form Area -->
            <div class="form-area">
                <form action="/start" method="POST">
                    <input type="text" name="name" placeholder="Enter a username for your session" required>
                    <button type="submit">Start</button>
                </form>
            </div>
        </div>

    </div>

    <div class="overlay" id="overlay"></div>

    <script>

        const tourButton = document.getElementById('tour-button');
        const overlay = document.getElementById('overlay');
        const speechBubble = document.getElementById('speech-bubble');

        // Multi-step dialogues for each option
        const dialogues = {
            option1: [ /*What is GPianoroll?*/
                "GPianoroll is an interface for creating music using Gaussian Processes (GP) and Bayesian Optimization (BO).",
                "Long story short, it allows you to generate short music sequences with AI assistance.",
                "Technology and music all together! Isn't it fun?"
            ],
            option1_1:[ /*I read some strong opinions about AI art...*/
                "It is a heavy topic, but bear in mind it is not the main point of this work.",
                "This app's goal isn't to make an 'AI composer', but to test BO on something as abstract as human taste.",
                "\"Sure, it can make a machine play chess and go at Greatmaster level, but can it *JAM*?\"",
                "The two main points against AI going artistic are content theft and job intrusism. Fair points, but not GPianoroll's case.",
                "Our AI was trained using public domain music made into MIDI, which can be accessed for free and with no copyrights infringed.",
                "Besides, our jingles just last for 10 seconds, so, honestly, we are no threat to artists.",
                "In fact, all my dialogues and my character design are human-created! We support art!"
            ],
            option2: [ /*How does GPianoroll work?*/
                "First, you enter a username. It can be any name, really. We will just use it, with the date and time, to identify the songs you generate.",
                "Once you enter, we ask a Deep Learning model to generate a 10 second song, and then you can listen to it.",
                "Then you need to grade it, the program learns which pieces you like and which you don't, and progressively becomes better at making the ones you *do* like.",
                "It takes about 30 mins, on average, but in an uncontroled environment like the Internet, it can be faster or slower.",
                "I can tell you more about it once we begin an experiment."
            ],
            option3: [ /*... BAstIEn?*/
                "It stands for 'Bayesian Application assiSTant for Interface ENgagement'!",
                "It basically means I'm a cute face to put in front of the app, so it is more appealing!",
                "That way, more users can contribute to making science!",
                "... though you can always hide me in case you don't like me. No pressure.",
                "I'll also be answering your questions, if you have any. Just say the word."
            ]
        };

        let dialogueStep = 0;
        let currentOption = null;
        let dialogue_on = false;

        // Function to unset the overlay
        function resetBubble() {
            speechBubble.innerHTML = `
                <p>Welcome to GPianoroll! Enter your username to start.</p>
                <p>First time? Click the button below.</p>
            `;
            tourButton.removeEventListener('click',resetBubble)
            tourButton.addEventListener('click',setBubble)
            tourButton.textContent = 'Show me around!'
        }

        // Function to reset the dialogue and buttons
        function setBubble() {
            speechBubble.innerHTML = `
                <p>Hi! I'm BAstIEn! Can I answer any of your questions?</p>
                <div class="bubble-buttons" id="bubble-buttons">
                    <button class="bubble-button" id="option1">What is GPianoroll?</button>
                    <button class="bubble-button" id="option2">How does this app work?</button>
                    <button class="bubble-button" id="option3">... BAstIEn?</button>
                </div>
            `;
            assignButtonListeners();
            tourButton.removeEventListener('click',setBubble)
            tourButton.addEventListener('click',resetBubble)
            dialogueStep = 0;
            currentOption = null;
            tourButton.textContent = 'OK, thanks'
        }

        // Function to show the next dialogue step
        function showNextDialogue() {
            if (currentOption && dialogueStep < dialogues[currentOption].length) {
                speechBubble.innerHTML = `
                    <p>${dialogues[currentOption][dialogueStep]}</p>
                    <div class="bubble-buttons" id="bubble-buttons">
                        <button class="bubble-button" id="next">Next</button>
                    </div>
                `;

                if (dialogueStep == dialogues[currentOption].length-1) {
                    showOtherDialogues();
                    document.getElementById('next').textContent='OK'
                } 

                document.getElementById('next').addEventListener('click', () => {
                    dialogueStep++;
                    if (dialogueStep < dialogues[currentOption].length) {
                        showNextDialogue();
                    } else {
                        setBubble();
                    }
                });
            }
        }

        function showOtherDialogues() {
            let bubble_buttons=document.getElementById('bubble-buttons');

            if (currentOption=='option1'){
                bubble_buttons.innerHTML += `
                    <button class="bubble-button" id="option1_1">I read some strong opinions about AI art...</button>
                    <button class="bubble-button" id="option2">How does this app work?</button>
                `
                assignButtonListeners()
            } else if (currentOption=='option1_1'){
                bubble_buttons.innerHTML += `
                    <button class="bubble-button" id="option2">How does this app work?</button>
                `
                assignButtonListeners()
            }
        }

        // Assign button listeners to trigger dialogues
        function assignButtonListeners() {

            let option1 = document.getElementById('option1');
            let option1_1 = document.getElementById('option1_1');
            let option2 = document.getElementById('option2');
            let option3 = document.getElementById('option3');

            if (option1){
                option1.addEventListener('click', () => {
                    currentOption = 'option1';
                    dialogueStep = 0;
                    showNextDialogue();
                });
            }


            if (option1_1){
                option1_1.addEventListener('click', () => {
                    currentOption = 'option1_1';
                    dialogueStep = 0;
                    showNextDialogue();
                });
            }

            if (option2){
                option2.addEventListener('click', () => {
                    currentOption = 'option2';
                    dialogueStep = 0;
                    showNextDialogue();
                });
            }

            if (option3){
                option3.addEventListener('click', () => {
                    currentOption = 'option3';
                    dialogueStep = 0;
                    showNextDialogue();
                });
            }


        }

        function dialogue_onoff() {

            if (dialogue_on) {
                dialogue_on = false;
                resetBubble();
            } else {
                dialogue_on = true;
                setBubble();
            }

        }

        resetBubble()

    </script>

</body>
</html>
