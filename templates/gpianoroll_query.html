<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPianoroll</title>
    <style>

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
        }

        /* Main container for both content and sidebar */
        .container {
            display: flex;
            flex: 1;
            margin: 20px;
        }

        /* Main container for both content and sidebar */
        .vertical_container{
            display: flex;
            flex: 1;
            margin: 20px;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Main content area where images/plots will be displayed */
        .main-area {
            flex: 4;
            background-color: rgba(0, 128, 128, 0.6); /* Teal with 60% transparency */
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 15px;
            position: relative;
            margin-right: 20px; /* Added margin between main area and sidebar */
        }

        /* Title area at the top of the main area */
        .title-area {
            width: 100%;
            text-align: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            color: white;
            font-size: 1.5em;
        }

        /* Sidebar for the slider and textbox */
        .sidebar {
            flex: 1;
            background-color: rgba(0, 128, 128, 0.6); /* Teal with 60% transparency */
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            border-radius: 15px;
            transition: all 0.5s ease;
            max-width: 300px;
        }

        /* Sidebar hidden state */
        .sidebar-hidden {
            max-width: 0;
            padding: 0;
            overflow: hidden;
            transition: all 0.5s ease;
        }

        /* Hide the contents when sidebar is collapsed */
        .sidebar-hidden form {
            display: none;
        }

        /* Vertical Slider Input */
        input[type="range"] {
            height: 400px; /* Increase slider height */
            width: 80%; /* Adjust text input width */
            transform: rotate(-90deg); /* Vertical slider */
        }

        /* Textbox Input */
        input[type="text"] {
            width: 80%; /* Adjust text input width */
        }

        /* Form elements styling */
        label {
            color: white;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        /* Submit button styling */
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 10px;
        }

        button:hover {
            background-color: #45a049;
        }

        /* Show/Hide Sidebar button */
        .toggle-sidebar {
            position: absolute;
            bottom: 20px;
            right: 20px; /* Button placed in the bottom-right corner */
            padding: 10px 20px;
            background-color: teal;
            color: white;
            border: none;
            cursor: pointer;
        }

        .toggle-sidebar:hover {
            background-color: #008080;
        }

        img {
            width: 100%;
            max-width: 500px;
            height: auto;
            border-radius: 10px;
        }

        /* Mascot container */
        .mascot-container {
            flex: 3;
            display: flex;
            align-items: center;
            justify-content: center; /* Center vertically within its area */
            margin-top: 0; /* Ensure no extra margin interferes with centering */
            z-index: 9; /* Ensures the bubble is on top of the container */
            background-color: rgba(0, 128, 128, 0.6); /* Teal with 60% transparency */
            border-radius: 15px;
            padding: 20px;
            margin-right: 20px;
            max-width: 600px;
            transition: all 0.5s ease;
        }

        /* Mascot container */
        .mascot-container-hidden {
            max-width: 0;
            padding: 0;
            overflow: hidden;
            transition: all 0.5s ease;
        }

        /* Mascot image */
        .mascot {
            height: 90vh; /* Full height of the screen */
            max-width: 700px;
            width: auto;
            margin-bottom: 10px;
        }

        /* Sidebar hidden state */
        .mascot-hidden {
            max-width: 0;
            padding: 0;
            overflow: hidden;
            transition: all 0.5s ease;
        }

        /* Show/Hide Sidebar button */
        .toggle-mascot{
            position: absolute;
            bottom: 20px;
            left: 20px; /* Button placed in the bottom-right corner */
            padding: 10px 20px;
            background-color: teal;
            color: white;
            border: none;
            cursor: pointer;
        }

        .toggle-mascot:hover {
            background-color: #008080;
        }

        /* Speech bubble styling */
        .speech-bubble {
            position: relative;
            top: -20%;
            transform: translateY(-50%); /* Center vertically */
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 10px;
            max-width: 20vw;
            text-align: center;
            font-size: 1em;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 10; /* Ensures the bubble is on top of the container */
            margin-left: 20px; /* Increased margin for more space */
            transition: all 0.5s ease;
        }

        .speech-bubble button {
            padding: 3px 3px;
            border-radius: 3px;

        }

        /* Speech bubble styling */
        .speech-bubble-hidden {
            max-width: 0;
            padding: 0;
            overflow: hidden;
            transition: all 0.5s ease;
        }

        /* Arrow for the speech bubble */
        .speech-bubble::after {
            content: '';
            position: absolute;
            top: 50%;
            left: -15px; /* Move arrow to the left of the speech bubble */
            margin-top: -10px; /* Adjust positioning */
            border-width: 10px;
            border-style: solid;
            border-color: transparent rgba(255, 255, 255, 0.9) transparent transparent; /* Change to match the bubble */
        }

    </style>
    <script src="https://cdn.jsdelivr.net/combine/npm/tone@14.7.58,npm/@magenta/music@1.23.1/es6/core.js,npm/focus-visible@5,npm/html-midi-player@1.4.0"></script>
</head>
<body>

    <div class="container">

        <!-- Mascot and Speech Bubble -->
        <div class="mascot-container" id="bastien-container">
            <img src="/static/Bastien.png" alt="Mascot" class="mascot" id="bastien">
            <div class="speech-bubble" id="speech-bubble">
                <p>Ask away if I can be of assistance.</p>
            </div>
        </div>
        
        <!-- Main Area for Image/Plot Display -->
        <div class="main-area" id="main-area">
            <!-- Title Area -->
            <div class="title-area">
                <h1>Here's your song. Rate it:</h1>
            </div>
            <!-- Image/Plot -->
            <midi-visualizer type="piano-roll" id="museGANVisualizer" src="{{mid}}"></midi-visualizer>
            <midi-player src="{{mid}}" sound-font visualizer="#museGANVisualizer" id="museGANPlayer">
            </midi-player>            
            <!-- Toggle Sidebar Button -->
            <button class="toggle-sidebar" id="toggle-sidebar-btn">Toggle sidebar</button>
            <button class="toggle-mascot" id="toggle-mascot-btn">Toggle helper</button>
        </div>

        <!-- Sidebar for Slider and Textbox Input -->
        <div class="sidebar" id="sidebar">
            <form id="score-form" action="/input_result" method="POST">
                <label for="score">Rate the composition:</label>
                <!-- Vertical Slider Input -->
                <input type="range" id="score-slider" name="score" min="0" max="100" value="50">
                <!-- Textbox Input -->
                <input type="text" id="score-textbox" value="50">
                <!-- Submit Button -->
                <button type="submit">Submit Score</button>
            </form>
        </div>

    </div>

    <script>
        const slider = document.getElementById('score-slider');
        const textbox = document.getElementById('score-textbox');
        const sidebar = document.getElementById('sidebar');
        const mascot = document.getElementById('bastien');
        const mascotSidebar = document.getElementById('bastien-container');
        const speechBubble = document.getElementById('speech-bubble');
        const toggleBtn = document.getElementById('toggle-sidebar-btn');
        const toggleMascotBtn = document.getElementById('toggle-mascot-btn');

        // Synchronize slider and textbox values
        slider.addEventListener('input', function() {
            textbox.value = slider.value;
        });

        textbox.addEventListener('input', function() {
            // Allow only numbers
            let value = textbox.value.replace(/[^0-9]/g, '');
            textbox.value = value;

            // Clip the value between 0 and 100
            if (value !== '') {
                value = Math.max(0, Math.min(100, value));
                textbox.value = value;
                slider.value = value; // Sync the slider with the clipped value
            }
        });

        // Toggle the sidebar visibility with a sliding animation
        toggleBtn.addEventListener('click', function() {
            sidebar.classList.toggle('sidebar-hidden');
        });

        // Toggle the sidebar visibility with a sliding animation
        toggleMascotBtn.addEventListener('click', function() {
            mascot.classList.toggle('mascot-hidden');
            mascotSidebar.classList.toggle('mascot-container-hidden');
            speechBubble.classList.toggle('speech-bubble-hidden');
        });

        // Function to reset the dialogue and buttons
        function setBubble() {
            speechBubble.innerHTML = `
                <p>If I can be of assistance, ask away.</p>
                <div class="bubble-buttons" id="bubble-buttons">
                    <button class="bubble-button" id="option1">What do I do?</button>
                </div>
            `;
            dialogueStep = 0;
        }

        setBubble();

        const option1 = document.getElementById('option1');

        dialogues = [
            "In the middle area, there should be a MIDI player. If you press the play button, you can listen to it.",
            "Then, to the right, you should see a sidebar. If it is not there, toggle it using the bottom left button.",
            "Use either the slider or the textbox to input a score. Scores go from 0 to 100, and the higher the better.",
            "Also, if you happen to give the same score to two samples, the most recent is considered best.",
            "Giving scores out of the blue may seem complicated at first, but you can choose whatever criteria you want.",
            "I could give you specific examples, but I don't want to create biases. You'll have to figure it out yourself.",
            "Once you are happy with your score, submit it with the button. You'll return to this same page with a different song.",
            "This score is fed to our Bayesian Optimization program, and is enough to guide it towards pieces you'll probably like.",
            "No reasoning needed, no tags, no ratings... Our system should be able to find something you vibe with just with your feedback.",
            "Bear in mind, though, that since we start from zero information, the program might try very different generations. Specially at the beginning.",
            "At some point we'll call it quits, and you'll arrive at a logout page where we will show you your best rated sample. You can even download them!",
            "That's basically it. Ask again and I'll repeat the explanation."
        ]
        
        option1.addEventListener('click', () => {
            dialogueStep = 0;
            showNextDialogue();
        });

        // Function to show the next dialogue step
        function showNextDialogue() {
            if (dialogueStep < dialogues.length) {
                speechBubble.innerHTML = `
                    <p>${dialogues[dialogueStep]}</p>
                    <div class="bubble-buttons" id="bubble-buttons">
                        <button class="bubble-button" id="next">Next</button>
                    </div>
                `;

                if (dialogueStep == dialogues.length-1) {
                    document.getElementById('next').textContent='OK'
                } 

                document.getElementById('next').addEventListener('click', () => {
                    dialogueStep++;
                    if (dialogueStep < dialogues.length) {
                        showNextDialogue();
                    } else {
                        setBubble();
                    }
                });
            }
        }

    </script>

</body>
</html>
